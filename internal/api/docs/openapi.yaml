openapi: 3.0.3
info:
  description: API specification for the MonzaImola Orchestrator
  title: Arduino-App-Cli
  version: 0.1.0
servers:
- description: local server
  url: http://localhost:8080
tags:
- name: Application
- name: Brick
- name: AIModels
- name: System
paths:
  /v1/apps:
    get:
      description: Returns a list of all apps, and example present. It is also possible
        to apply different filters.
      operationId: getApps
      parameters:
      - description: Filters apps by apps,examples,default
        in: query
        name: filter
        schema:
          description: Filters apps by apps,examples,default
          type: string
      - description: Filters applications by status
        in: query
        name: status
        schema:
          $ref: '#/components/schemas/Status'
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppListResponse'
          description: Successful response
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get a list of installed apps/examples
      tags:
      - Application
    post:
      description: Creates a new app in the default app location.
      operationId: createApp
      parameters:
      - description: If true, the app will not be created with the python part.
        in: query
        name: skip-python
        schema:
          description: If true, the app will not be created with the python part.
          type: boolean
      - description: If true, the app will not be created with the sketch part.
        in: query
        name: skip-sketch
        schema:
          description: If true, the app will not be created with the sketch part.
          type: boolean
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAppRequest'
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateAppResponse'
          description: Successful response
        "400":
          $ref: '#/components/responses/BadRequest'
        "409":
          $ref: '#/components/responses/Conflict'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Creates a new app
      tags:
      - Application
  /v1/apps/{appID}/bricks:
    get:
      description: Get the list of brick instances for a specific app.
      operationId: getAppBrickInstances
      parameters:
      - description: application identifier.
        in: path
        name: appID
        required: true
        schema:
          description: application identifier.
          type: string
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppBrickInstancesResult'
          description: Successful response
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get brick instances for an app
      tags:
      - Application
  /v1/apps/{appID}/bricks/{brickID}:
    delete:
      description: Delete a brick instance for an app. It will remove the brick instance
        from the app.
      operationId: deleteAppBrickInstance
      parameters:
      - description: application identifier.
        in: path
        name: appID
        required: true
        schema:
          description: application identifier.
          type: string
      - description: brick identifier.
        in: path
        name: brickID
        required: true
        schema:
          description: brick identifier.
          type: string
      responses:
        "200":
          description: Successful response
        "400":
          $ref: '#/components/responses/BadRequest'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Delete a brick instance for an app
      tags:
      - Application
    get:
      description: Get a specific brick instance for an app by its ID.
      operationId: getAppBrickInstanceByBrickID
      parameters:
      - description: application identifier.
        in: path
        name: appID
        required: true
        schema:
          description: application identifier.
          type: string
      - description: brick identifier.
        in: path
        name: brickID
        required: true
        schema:
          description: brick identifier.
          type: string
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrickInstance'
          description: Successful response
        "400":
          $ref: '#/components/responses/BadRequest'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get a specific brick instance by ID
      tags:
      - Application
    patch:
      description: Update a brick instance for an app. It update/add only the provided
        fields.
      operationId: updateAppBrickInstance
      parameters:
      - description: application identifier.
        in: path
        name: appID
        required: true
        schema:
          description: application identifier.
          type: string
      - description: brick identifier.
        in: path
        name: brickID
        required: true
        schema:
          description: brick identifier.
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BrickCreateUpdateRequest'
      responses:
        "200":
          description: Successful response
        "400":
          $ref: '#/components/responses/BadRequest'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Update a brick instance for an app
      tags:
      - Application
    put:
      description: Upsert a brick instance for an app. If the instance does not exist,
        it will be created. If it exists, it will be updated.
      operationId: upsertAppBrickInstance
      parameters:
      - description: application identifier.
        in: path
        name: appID
        required: true
        schema:
          description: application identifier.
          type: string
      - description: brick identifier.
        in: path
        name: brickID
        required: true
        schema:
          description: brick identifier.
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/BrickCreateUpdateRequest'
      responses:
        "200":
          description: Successful response
        "400":
          $ref: '#/components/responses/BadRequest'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Upsert a brick instance for an app
      tags:
      - Application
  /v1/apps/{id}:
    delete:
      description: Remove the given app and all the resources it created
      operationId: deleteApp
      parameters:
      - description: application identifier.
        in: path
        name: id
        required: true
        schema:
          description: application identifier.
          type: string
      responses:
        "200":
          description: Successful response
        "400":
          $ref: '#/components/responses/BadRequest'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: delete the app
      tags:
      - Application
    get:
      description: Return all the detail for the given app
      operationId: getAppDetails
      parameters:
      - description: application identifier.
        in: path
        name: id
        required: true
        schema:
          description: application identifier.
          type: string
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AppDetailedInfo'
          description: Successful response
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get app/example detail
      tags:
      - Application
    patch:
      description: Edit the given application. Is it possible to modify the default
        status, to add/remove/update bricks and bricks variables.
      operationId: editApp
      parameters:
      - description: application identifier.
        in: path
        name: id
        required: true
        schema:
          description: application identifier.
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EditRequest'
      responses:
        "200":
          description: Successful response
        "400":
          $ref: '#/components/responses/BadRequest'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Update App Details
      tags:
      - Application
  /v1/apps/{id}/clone:
    post:
      description: Clone an existing app or example, in a new one. It is possible
        to specify the new name and icon.
      operationId: cloneApp
      parameters:
      - description: application identifier.
        in: path
        name: id
        required: true
        schema:
          description: application identifier.
          type: string
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CloneRequest'
      responses:
        "201":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CloneAppResponse'
          description: Successful response
        "400":
          $ref: '#/components/responses/BadRequest'
        "404":
          $ref: '#/components/responses/NotFound'
        "409":
          $ref: '#/components/responses/Conflict'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Creates a new app, from another app or example identified by ID.
      tags:
      - Application
  /v1/apps/{id}/events:
    get:
      description: 'Returns events for a specific app '
      operationId: getAppEvents
      parameters:
      - description: application identifier.
        in: path
        name: id
        required: true
        schema:
          description: application identifier.
          type: string
      responses:
        "200":
          content:
            text/event-stream:
              schema:
                type: string
          description: OK
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: 'Get application events '
      tags:
      - Application
  /v1/apps/{id}/logs:
    get:
      description: Obtain a ServerSentEvnt stream of logs. It is possible to apply
        different filters.
      operationId: getAppLogs
      parameters:
      - in: query
        name: filter
        schema:
          type: string
      - in: query
        name: tail
        schema:
          type: integer
      - in: query
        name: nofollow
        schema:
          type: boolean
      - description: application identifier.
        in: path
        name: id
        required: true
        schema:
          description: application identifier.
          type: string
      responses:
        "200":
          content:
            text/event-stream:
              schema:
                type: string
          description: OK
        "400":
          $ref: '#/components/responses/BadRequest'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get the logs of a running app
      tags:
      - Application
  /v1/apps/{id}/start:
    post:
      description: Start the application and handles all the operation to start any
        dependecies. If the app contains a sketch it also flash it in the micro.
      operationId: startApp
      parameters:
      - description: application identifier.
        in: path
        name: id
        required: true
        schema:
          description: application identifier.
          type: string
      responses:
        "200":
          content:
            text/event-stream:
              schema:
                type: string
          description: |
            A stream of Server-Sent Events (SSE) that notifies the progress.
            The client will receive events formatted as follows:

            **Event 'progress'**:
            Contains a JSON object with the percentage of completion.
            'event: progress'
            'data: {"progress":0.25}'

            **Event 'message'**:
            Contains a JSON object with an informational message.
            'event: message'
            'data: {"message":"Starting container..."}'

            **Event 'error'**:
            Contains a JSON object with the details of an error.
            'event: error'
            'data: {"code":"INTERNAL_SERVER_ERROR","message":"An error occurred during operation"}'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Start an existing app/example
      tags:
      - Application
  /v1/apps/{id}/stop:
    post:
      description: Stop the application and all it's dependecies. If the app contains
        a sketch it also remove it from the micro.
      operationId: stopApp
      parameters:
      - description: application identifier.
        in: path
        name: id
        required: true
        schema:
          description: application identifier.
          type: string
      responses:
        "200":
          content:
            text/event-stream:
              schema:
                type: string
          description: |
            A stream of Server-Sent Events (SSE) that notifies the progress.
            The client will receive events formatted as follows:

            **Event 'progress'**:
            Contains a JSON object with the percentage of completion.
            'event: progress'
            'data: {"progress":0.25}'

            **Event 'message'**:
            Contains a JSON object with an informational message.
            'event: message'
            'data: {"message":"Stopping container..."}'

            **Event 'error'**:
            Contains a JSON object with the details of an error.
            'event: error'
            'data: {"code":"INTERNAL_SERVER_ERROR","message":"An error occurred during operation"}'
        "412":
          $ref: '#/components/responses/PreconditionFailed'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Stop an existing app/example
      tags:
      - Application
  /v1/bricks:
    get:
      description: Returns all the existing bricks. Bricks that are ready to use are
        marked as installed.
      operationId: getBricks
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrickListResult'
          description: Successful response
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get a list of available bricks
      tags:
      - Brick
  /v1/bricks/{id}:
    get:
      description: Returns a detailed list of property associated to the given brick.
      operationId: getBrickDetails
      parameters:
      - description: brick identifier.
        in: path
        name: id
        required: true
        schema:
          description: brick identifier.
          type: string
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/BrickDetailsResult'
          description: Successful response
        "400":
          $ref: '#/components/responses/BadRequest'
        "404":
          $ref: '#/components/responses/NotFound'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Detail of a brick
      tags:
      - Brick
  /v1/config:
    get:
      description: returns information about current directory configuration used
        by the app
      operationId: getConfig
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ConfigResponse'
          description: Successful response
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: returns application configuration
      tags:
      - Application
  /v1/models:
    get:
      description: Returns the list of AI models available in the system. It is possible
        to filter the models by bricks.
      operationId: getAIModels
      parameters:
      - description: Filter models by bricks. If not specified, all models are returned.
        in: query
        name: bricks
        schema:
          description: Filter models by bricks. If not specified, all models are returned.
          type: string
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIModelsListResult'
          description: Successful response
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get a list of available AI models
      tags:
      - AIModels
  /v1/models/{id}:
    get:
      description: Returns the details of a specific AI model.
      operationId: getAIModelDetails
      parameters:
      - description: AI model identifier.
        in: path
        name: id
        required: true
        schema:
          description: AI model identifier.
          type: string
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AIModelItem'
          description: Successful response
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get AI model details
      tags:
      - AIModels
  /v1/system/resources:
    get:
      description: Returns the system resources usage, such as memory, disk and CPU.
      operationId: getSystemResources
      responses:
        "200":
          content:
            text/event-stream:
              schema:
                type: string
          description: |
            A stream of Server-Sent Events (SSE) that notifies the stats.
            The client will receive events formatted as follows:

            **Event 'cpu'**:
            Contains a JSON object with the CPU information.
            'event: stats'
            'data: {"used_percent": 0.25}'

            **Event 'mem'**:
            Contains a JSON object with the memory information.
            'event: mem'
            'data: {"used": 1024, "total": 2048}'

            **Event 'disk'**:
            Contains a JSON object with the disk information.
            'event: disk'
            'data: {"path":"/", "used": 512, "total": 1024}'

            **Event 'error'**:
            Contains a JSON object with the details of an error.
            'event: error'
            'data: {"code":"INTERNAL_SERVER_ERROR","message":"An error occurred during operation"}'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get system resources usage
      tags:
      - System
  /v1/system/update/apply:
    put:
      description: Start the upgrade process.
      operationId: applyUpdate
      parameters:
      - description: If true, upgrade only the Arduino packages that require an upgrade.
          Default is false.
        in: query
        name: only-arduino
        schema:
          description: If true, upgrade only the Arduino packages that require an
            upgrade. Default is false.
          type: boolean
      responses:
        "200":
          description: Successful response
        "204":
          $ref: '#/components/responses/NoContent'
        "409":
          $ref: '#/components/responses/Conflict'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Start the upgrade process in background
      tags:
      - System
  /v1/system/update/check:
    get:
      description: Returns the details of packages to be upgraded.
      operationId: checkUpdate
      parameters:
      - description: If true, check only for Arduino packages that require an upgrade.
          Default is false.
        in: query
        name: only-arduino
        schema:
          description: If true, check only for Arduino packages that require an upgrade.
            Default is false.
          type: boolean
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UpdateCheckResult'
          description: Successful response
        "204":
          $ref: '#/components/responses/NoContent'
        "400":
          $ref: '#/components/responses/BadRequest'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: Get the packages that requires an upgrade
      tags:
      - System
  /v1/system/update/events:
    get:
      description: Returns the events of current update process.
      operationId: eventsUpdate
      responses:
        "200":
          content:
            text/event-stream:
              schema:
                type: string
          description: |
            A stream of Server-Sent Events (SSE) that notifies the progress of the update process.
            The client will receive events formatted as follows:

            **Event 'log'**:
            Contains a log message of the apt upgrade command.
            'event: log'
            'data: "updating package: 0.25"'

            **Event 'restarting'**:
            Contains a string with the message that the upgrade is completed and the system is restarting.
            'event: restarting'
            'data: Upgrade completed. Restarting'

            **Event 'error'**:
            Contains a JSON object with the details of an error.
            'event: error'
            'data: {"code":"internal_service_err","message":"An error occurred during operation"}'
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: SSE stream of the update process
      tags:
      - System
  /v1/version:
    get:
      description: returns the application current version
      operationId: getVersions
      responses:
        "200":
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VersionResponse'
          description: Successful response
        "500":
          $ref: '#/components/responses/InternalServerError'
      summary: application version
      tags:
      - Application
components:
  responses:
    BadRequest:
      content:
        application/json:
          example:
            details: The request is invalid or missing required parameters.
          schema:
            $ref: '#/components/schemas/ErrorResponse'
      description: Bad Request
    Conflict:
      content:
        application/json:
          example:
            details: There is a conflict with an existing resource.
          schema:
            $ref: '#/components/schemas/ErrorResponse'
      description: Conflict
    InternalServerError:
      content:
        application/json:
          example:
            details: An unexpected error occurred.
          schema:
            $ref: '#/components/schemas/ErrorResponse'
      description: Internal Server Error
    NoContent:
      content:
        application/json:
          example:
            details: No content to return.
          schema:
            $ref: '#/components/schemas/ErrorResponse'
      description: No Content
    NotFound:
      content:
        application/json:
          example:
            details: The requested resource was not found.
          schema:
            $ref: '#/components/schemas/ErrorResponse'
      description: Not Found
    PreconditionFailed:
      content:
        application/json:
          example:
            details: The request is invalid.
          schema:
            $ref: '#/components/schemas/ErrorResponse'
      description: Precondition Failed
  schemas:
    AIModelItem:
      properties:
        brick_id:
          type: string
        description:
          type: string
        id:
          type: string
        metadata:
          additionalProperties:
            type: string
          type: object
        model_configuration:
          additionalProperties:
            type: string
          type: object
        name:
          type: string
        runner:
          type: string
      type: object
    AIModelsListResult:
      properties:
        models:
          items:
            $ref: '#/components/schemas/AIModelItem'
          nullable: true
          type: array
      type: object
    AppBrickInstancesResult:
      properties:
        bricks:
          items:
            $ref: '#/components/schemas/BrickInstance'
          nullable: true
          type: array
      type: object
    AppDetailedBrick:
      properties:
        category:
          type: string
        id:
          type: string
        name:
          type: string
      required:
      - id
      - name
      type: object
    AppDetailedInfo:
      properties:
        bricks:
          items:
            $ref: '#/components/schemas/AppDetailedBrick'
          type: array
        default:
          type: boolean
        description:
          type: string
        example:
          type: boolean
        icon:
          type: string
        id:
          type: string
        name:
          type: string
        path:
          type: string
        status:
          $ref: '#/components/schemas/Status'
      required:
      - id
      - name
      - status
      type: object
    AppInfo:
      properties:
        default:
          type: boolean
        description:
          type: string
        example:
          type: boolean
        icon:
          type: string
        id:
          type: string
        name:
          type: string
        status:
          $ref: '#/components/schemas/Status'
      type: object
    AppListResponse:
      properties:
        apps:
          description: List of applications
          items:
            $ref: '#/components/schemas/AppInfo'
          nullable: true
          type: array
      type: object
    AppReference:
      properties:
        icon:
          type: string
        id:
          type: string
        name:
          type: string
      type: object
    BrickCreateUpdateRequest:
      properties:
        model:
          nullable: true
          type: string
        variables:
          additionalProperties:
            type: string
          type: object
      type: object
    BrickDetailsResult:
      properties:
        author:
          type: string
        category:
          type: string
        description:
          type: string
        id:
          type: string
        name:
          type: string
        readme:
          type: string
        status:
          type: string
        used_by_apps:
          items:
            $ref: '#/components/schemas/AppReference'
          nullable: true
          type: array
        variables:
          additionalProperties:
            $ref: '#/components/schemas/BrickVariable'
          type: object
      type: object
    BrickInstance:
      properties:
        author:
          type: string
        category:
          type: string
        id:
          type: string
        model:
          type: string
        name:
          type: string
        status:
          type: string
        variables:
          additionalProperties:
            type: string
          type: object
      type: object
    BrickListItem:
      properties:
        author:
          type: string
        category:
          type: string
        description:
          type: string
        id:
          type: string
        models:
          items:
            type: string
          nullable: true
          type: array
        name:
          type: string
        status:
          type: string
      type: object
    BrickListResult:
      properties:
        bricks:
          items:
            $ref: '#/components/schemas/BrickListItem'
          nullable: true
          type: array
      type: object
    BrickVariable:
      properties:
        default_value:
          type: string
        description:
          type: string
        required:
          type: boolean
      type: object
    CloneAppResponse:
      properties:
        id:
          type: string
      type: object
    CloneRequest:
      properties:
        icon:
          description: application icon
          nullable: true
          type: string
        name:
          description: application name
          example: My Awesome App
          nullable: true
          type: string
      type: object
    ConfigDirectories:
      properties:
        apps:
          type: string
        data:
          type: string
        examples:
          type: string
      type: object
    ConfigResponse:
      properties:
        directories:
          $ref: '#/components/schemas/ConfigDirectories'
      type: object
    CreateAppRequest:
      properties:
        bricks:
          description: application bricks
          example:
          - core-auth
          - data-storage
          items:
            type: string
          type: array
        icon:
          description: application icon
          type: string
        name:
          description: application name
          example: My Awesome App
          type: string
      required:
      - name
      type: object
    CreateAppResponse:
      properties:
        id:
          type: string
      type: object
    EditRequest:
      properties:
        default:
          nullable: true
          type: boolean
        description:
          description: application description
          example: This is my awesome app
          nullable: true
          type: string
        icon:
          description: application icon
          example: "\U0001F4BB"
          nullable: true
          type: string
        name:
          description: application name
          example: My Awesome App
          nullable: true
          type: string
      type: object
    ErrorResponse:
      properties:
        code:
          type: integer
        message:
          type: string
      type: object
    Status:
      description: Application status
      enum:
      - starting
      - running
      - stopping
      - stopped
      - failed
      type: string
      uniqueItems: true
    UpdateCheckResult:
      properties:
        packages:
          items:
            $ref: '#/components/schemas/UpgradablePackage'
          nullable: true
          type: array
      type: object
    UpgradablePackage:
      properties:
        from_version:
          type: string
        name:
          type: string
        to_version:
          type: string
      type: object
    VersionResponse:
      properties:
        version:
          type: string
      type: object
